<!doctype html><html class=no-js lang=en><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=siteBaseUrl content="https://azurecodingarchitect.com/"><meta name=author content="Bas van de Sande"><meta name=description content="Tinkering with Azure and other technologies"><meta name=keywords content="blog,azure,cosmosdb,aks,kubernetes,k3s,docker,c#,visualstudio,architecture,technology,xpirit"><meta name=generator content="Hugo 0.124.1"><title>Quick tip: Get in control by using your GitHub context | Azure Coding Architect
</title><meta name=description content="Use GitHub context to control your workflows"><meta itemprop=name content="Quick tip: Get in control by using your GitHub context"><meta itemprop=description content="Use GitHub context to control your workflows"><meta property="og:title" content="Quick tip: Get in control by using your GitHub context"><meta property="og:description" content="Use GitHub context to control your workflows"><meta property="og:image" content="https://azurecodingarchitect.com/ghcontext/ghcontext-feature.png"><meta property="og:url" content="https://azurecodingarchitect.com/posts/github-context/"><meta property="og:site_name" content="Azure Coding Architect"><meta property="og:type" content="article"><script src=/modernizr-simple.js></script><link href=/posts/github-context/ rel=alternate type=application/rss+xml title="Azure Coding Architect"><link href=/posts/github-context/ rel=feed type=application/rss+xml title="Azure Coding Architect"><link rel=canonical href=https://azurecodingarchitect.com/posts/github-context/><link rel=stylesheet href=https://azurecodingarchitect.com/theme.css></head><body class=bilberry-hugo-theme><nav><div class=container><ul class=topnav><li><a href=https://azurecodingarchitect.com/page/erd-creator/>Entity Relationship Diagram Creator</a></li><li><a href=https://xpirit.com/team/bas-van-de-sande/ target=_blank>About Me</a></li><li><a href=https://learn.microsoft.com/en-us/users/basvandesande-8898/transcript/vmzk8agyxgwpjkn target=_blank>Certifications</a></li></ul></div></nav><header><div class=container><div class=logo><a href=/ class=logo><img src=/bas.png alt>
<span class=overlay><i class="fa fa-home"></i></span></a></div><div class=titles><h3 class=title><a href=/>Azure Coding Architect</a></h3><span class=subtitle>Tinkering in the cloud...</span></div><div class=toggler><i class="fa fa-bars" aria-hidden=true></i></div></div></div></header><div class="main container"><div class="article-wrapper u-cf single"><a class=bubble href=https://azurecodingarchitect.com/posts/github-context/><i class="fas fa-fw fa-pencil-alt"></i></a><article class="default article"><div class=featured-image><a href=https://azurecodingarchitect.com/posts/github-context/><img src=/ghcontext/ghcontext-feature.png alt></a></div><div class=content><h1 class=article-title><a href=https://azurecodingarchitect.com/posts/github-context/>Quick tip: Get in control by using your GitHub context</a></h1><div class=meta><span class="date moment">2024-02-16</span>
<span class=readingTime>4 min read</span>
<span class=categories><a href=https://azurecodingarchitect.com/categories/technical/>Technical</a>
</span><span class=author><a href=https://azurecodingarchitect.com/author/bas-van-de-sande/>Bas Van De Sande</a></span></div><p>GitHib actions and workflows are very powerful by nature. They help me to build and deploy my Azure environments, without having me to do all the tedious and errorprone work. I create a pull request, have it peer reviewed and once approved my environments are provisoned the way I envisioned it. This is also the case at my current assignment for a large organization.
Last year the organization decided that a new change management system (which name I refuse to pronounce) should handle all changes.
This means that every step in the process needs to be documented and approved conform ITIL processes.</p><p>This collides with all DevOps principles in which teams are responsible for building and running their own code. Instead we are warped back into time, back to release calendars, back to a situation in which organizations release code a couple of times per year. While in the DevOps world we do many releases per day. <strong>*sigh*</strong></p><p>Anyway it is the status quo and we have to comply. Engineers wouldn&rsquo;t be engineers if they wouldn&rsquo;t try to find a way to automate the hack out of it, thus finding a way to create automated changes, risk assessments and approvals.</p><p>As we are working with GitHub workflows, we set up a way of working in which we build our specific code in branches, create pull requests and have the code merged back to the main branch. We have triggers on the workflows that ensure that the code gets validated, built and deployed at every push and pull request.</p><p>This means that each time the code gets merged back to main, a new release is created. In case of a specific label applied on the pull request we want to trigger an specific action that handles the change management proces. For this example I created the label &ldquo;<strong>test</strong>&rdquo;.</p><p><img src=/ghcontext/ghcontext-labeled-pr.png alt="Pull Request with specific label"></p><p>This is where the GitHub context comes in handy.</p><h2 id=github-context>Github context</h2><p>In a GitHub workflow, you can use variables and objects of all sorts. One of those objects is the GitHub context, that you can call by using <strong>$github</strong>. The Github context is a rich object that contains all information on the Pull Request, Workflow etc. You can check out the context by echoing it to the display while running the workflow. To see the actual contents you need to convert it to a Json representation, such as in the code below.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#f92672>jobs</span>:
</span></span><span style=display:flex><span>  <span style=color:#f92672>draft_release</span>:
</span></span><span style=display:flex><span>    <span style=color:#f92672>name</span>: <span style=color:#ae81ff>Create draft release</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>runs-on</span>: <span style=color:#ae81ff>ubuntu-latest</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>steps</span>:
</span></span><span style=display:flex><span>      - <span style=color:#f92672>name</span>: <span style=color:#ae81ff>Create draft release and label PR</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>id</span>: <span style=color:#ae81ff>create_draft</span>
</span></span><span style=display:flex><span>        <span style=color:#ae81ff>...</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>      - <span style=color:#f92672>name</span>: <span style=color:#ae81ff>dump context</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>run</span>: <span style=color:#ae81ff>echo &#39;${{ toJSON(github.event.pull_request) }}&#39;</span>
</span></span></code></pre></div><p>Atter running the specific job, you can check the contents of the context.</p><p><img src=/ghcontext/ghcontext-echo.png alt="Show the pull request info "></p><p>In our case we are interested to find all labels attached to the Pull Request. Looking through the Json, I find a labels array, containing multiple labels. To show them I alter my code in the workflow and run it again.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#f92672>jobs</span>:
</span></span><span style=display:flex><span>  <span style=color:#f92672>draft_release</span>:
</span></span><span style=display:flex><span>    <span style=color:#f92672>name</span>: <span style=color:#ae81ff>Create draft release</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>runs-on</span>: <span style=color:#ae81ff>ubuntu-latest</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>steps</span>:
</span></span><span style=display:flex><span>      - <span style=color:#f92672>name</span>: <span style=color:#ae81ff>Create draft release and label PR</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>id</span>: <span style=color:#ae81ff>create_draft</span>
</span></span><span style=display:flex><span>        <span style=color:#ae81ff>...</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>      - <span style=color:#f92672>name</span>: <span style=color:#ae81ff>dump context</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>run</span>: <span style=color:#ae81ff>echo &#39;${{ toJSON(github.event.pull_request.labels.*.name) }}&#39;</span>
</span></span><span style=display:flex><span>       
</span></span></code></pre></div><p><img src=/ghcontext/ghcontext-getvalues.png alt="Get specific value(s)"></p><h2 id=get-into-control>Get into control</h2><p>Now that I can access the labels (or other fields), I can do what I want to do! In my case I want to execute an action only if a particular label is set.
I extend the code in my workflow by placing an <code>if</code> condition on a step. In this condition I check if the labels array contains the &ldquo;<strong>test</strong>&rdquo; label.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#f92672>jobs</span>:
</span></span><span style=display:flex><span>  <span style=color:#f92672>draft_release</span>:
</span></span><span style=display:flex><span>    <span style=color:#f92672>name</span>: <span style=color:#ae81ff>Create draft release</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>runs-on</span>: <span style=color:#ae81ff>ubuntu-latest</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>steps</span>:
</span></span><span style=display:flex><span>      - <span style=color:#f92672>name</span>: <span style=color:#ae81ff>Create draft release and label PR</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>id</span>: <span style=color:#ae81ff>create_draft</span>
</span></span><span style=display:flex><span>        <span style=color:#ae81ff>...</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>      - <span style=color:#f92672>name</span>: <span style=color:#ae81ff>dump context</span>
</span></span><span style=display:flex><span>        <span style=color:#ae81ff>...</span>
</span></span><span style=display:flex><span>      
</span></span><span style=display:flex><span>      - <span style=color:#f92672>name</span>: <span style=color:#ae81ff>Do my check</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>if</span>: <span style=color:#ae81ff>${{ contains(github.event.issue.labels.*.name, &#39;test&#39; ) }}</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>run</span>: <span style=color:#ae81ff>echo &#34;Hello world!&#34;</span>
</span></span><span style=display:flex><span>        
</span></span></code></pre></div><p>I run the workflow again, and see that the action gets executed.</p><p><img src=/ghcontext/ghcontext-conditional-use.png alt="Use values for control"></p><p>I change the condition to check for a label that doesn&rsquo;t exist. And run the workflow again&mldr; This time, the action is skipped.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#f92672>jobs</span>:
</span></span><span style=display:flex><span>  <span style=color:#f92672>draft_release</span>:
</span></span><span style=display:flex><span>    <span style=color:#f92672>name</span>: <span style=color:#ae81ff>Create draft release</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>runs-on</span>: <span style=color:#ae81ff>ubuntu-latest</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>steps</span>:
</span></span><span style=display:flex><span>      - <span style=color:#f92672>name</span>: <span style=color:#ae81ff>Create draft release and label PR</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>id</span>: <span style=color:#ae81ff>create_draft</span>
</span></span><span style=display:flex><span>        <span style=color:#ae81ff>...</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>      - <span style=color:#f92672>name</span>: <span style=color:#ae81ff>dump context</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>run</span>: <span style=color:#ae81ff>echo &#39;${{ toJSON(github.event.pull_request) }}&#39;</span>
</span></span><span style=display:flex><span>      
</span></span><span style=display:flex><span>      - <span style=color:#f92672>name</span>: <span style=color:#ae81ff>Do my check</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>if</span>: <span style=color:#ae81ff>${{ contains(github.event.issue.labels.*.name, &#39;another test&#39; ) }}</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>run</span>: <span style=color:#ae81ff>echo &#34;Nothing to see... move on!&#34;</span>
</span></span><span style=display:flex><span>        
</span></span></code></pre></div><p><img src=/ghcontext/ghcontext-conditional-skip.png alt="Use values for control"></p><p>Such simple mechanism, though so powerful. By working with the context, I gained super powers when it comes to controlling my workflow.</p><p><em>Happy times ahead!</em></p></div><div class=footer><div class=tags><i class="fa fa-tags"></i><div class=links><a href=https://azurecodingarchitect.com/tags/github/>Github</a>
<a href=https://azurecodingarchitect.com/tags/context/>Context</a>
<a href=https://azurecodingarchitect.com/tags/workflows/>Workflows</a></div></div></div></article></div><div id=comments-container><script src=https://giscus.app/client.js data-repo=basvandesande/azurecodingarchitect data-repo-id=R_kgDOG3nWLg data-category=General data-category-id=DIC_kwDOG3nWLs4CBPIU data-mapping=pathname data-reactions-enabled=1 data-emit-metadata data-theme=light data-lang=en crossorigin=anonymous async></script><div id=giscus></div></div></div><footer><div class=container><div class=recent-posts><strong>Latest posts</strong><ul><li><a href=https://azurecodingarchitect.com/posts/github-context/>Quick tip: Get in control by using your GitHub context</a></li><li><a href=https://azurecodingarchitect.com/posts/find-rbac-permissions/>Quick tip: Find permissions in RBAC roles easily</a></li><li><a href=https://azurecodingarchitect.com/posts/diagnosticlogging/>Where is that documentation? A tale on setting up diagnostic settings...</a></li><li><a href=https://azurecodingarchitect.com/posts/frontdoor/>A nightmare on FrontDoor in Bicep...</a></li><li><a href=https://azurecodingarchitect.com/posts/gitcredentials/>Note to self: fix invalid GitHub credentials in VSCode</a></li><li><a href=https://azurecodingarchitect.com/posts/ghas-starting-with-codeql/>GHAS - How to use CodeQL custom queries?</a></li><li><a href=https://azurecodingarchitect.com/posts/sc100/>How to prepare for the Azure Cybersecurity Architect SC-100 exam</a></li></ul></div><div class=categories><a href=/categories/><strong>Categories</strong></a><ul><li><a href=/categories/development>Development
(8)</a></li><li><a href=/categories/general>General
(7)</a></li><li><a href=/categories/technical>Technical
(6)</a></li><li><a href=/categories/technology>Technology
(4)</a></li><li><a href=/categories/machine-learning>Machine learning
(1)</a></li><li><a href=/categories/tips-and-tricks>Tips and tricks
(1)</a></li><li><a href=/categories/troubleshooting>Troubleshooting
(1)</a></li></ul></div><div class=right><div class=external-profiles><strong>Social media</strong>
<a href=https://twitter.com/basvandesande target=_blank><i class="fab fa-twitter"></i></a>
<a href=https://linkd.in/basvandesande target=_blank><i class="fab fa-linkedin"></i></a>
<a href="mailto:bas@vd-sande.nl?subject=[AzureCodingArchitect]" target=_blank><i class="fa fa-envelope"></i></a>
<a href=/index.xml target=_blank><i class="fas fa-rss"></i></a></div><div class=external-profiles><strong>About me</strong>
<a href=https://xpirit.com/team/bas-van-de-sande/ target=_blank><i class="fas fa-robot" &nbsp;></i></a></div></div></div></footer><div class=credits><div class=container><div class=copyright><a href=https://azurecodingarchitect.com target=_blank>&copy;
2024
- Bas van de Sande - all rights reserved</div><div class=author><a href=https://github.com/Lednerb/bilberry-hugo-theme target=_blank>Bilberry Hugo theme</a></div></div></div><script type=text/javascript src=https://azurecodingarchitect.com/theme.js></script></body></html>