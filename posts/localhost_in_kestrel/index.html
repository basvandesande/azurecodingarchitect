<!doctype html><html class=no-js lang=en><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=siteBaseUrl content="https://azurecodingarchitect.com/"><meta name=author content="Bas van de Sande"><meta name=description content="Tinkering with Azure and other technologies"><meta name=keywords content="blog,azure,cosmosdb,aks,kubernetes,k3s,docker,c#,visualstudio,architecture,technology,xpirit"><meta name=generator content="Hugo 0.124.1"><title>Note to self: localhost in kestrel is localhost | Azure Coding Architect
</title><meta name=description content="Port binding under Kestrel does not alway work as expected. You need to specify the IP Address as well..."><meta itemprop=name content="Note to self: localhost in kestrel is localhost"><meta itemprop=description content="Port binding under Kestrel does not alway work as expected. You need to specify the IP Address as well..."><meta property="og:title" content="Note to self: localhost in kestrel is localhost"><meta property="og:description" content="Port binding under Kestrel does not alway work as expected. You need to specify the IP Address as well..."><meta property="og:image" content="https://azurecodingarchitect.com/kestrel/kestrel-feature.png"><meta property="og:url" content="https://azurecodingarchitect.com/posts/localhost_in_kestrel/"><meta property="og:site_name" content="Azure Coding Architect"><meta property="og:type" content="article"><script src=/modernizr-simple.js></script><link href=/posts/localhost_in_kestrel/ rel=alternate type=application/rss+xml title="Azure Coding Architect"><link href=/posts/localhost_in_kestrel/ rel=feed type=application/rss+xml title="Azure Coding Architect"><link rel=canonical href=https://azurecodingarchitect.com/posts/localhost_in_kestrel/><link rel=stylesheet href=https://azurecodingarchitect.com/theme.css></head><body class=bilberry-hugo-theme><nav><div class=container><ul class=topnav><li><a href=https://azurecodingarchitect.com/page/erd-creator/>Entity Relationship Diagram Creator</a></li><li><a href=https://xpirit.com/team/bas-van-de-sande/ target=_blank>About Me</a></li><li><a href=https://learn.microsoft.com/en-us/users/basvandesande-8898/transcript/vmzk8agyxgwpjkn target=_blank>Certifications</a></li></ul></div></nav><header><div class=container><div class=logo><a href=/ class=logo><img src=/bas.png alt>
<span class=overlay><i class="fa fa-home"></i></span></a></div><div class=titles><h3 class=title><a href=/>Azure Coding Architect</a></h3><span class=subtitle>Tinkering in the cloud...</span></div><div class=toggler><i class="fa fa-bars" aria-hidden=true></i></div></div></div></header><div class="main container"><div class="article-wrapper u-cf single"><a class=bubble href=https://azurecodingarchitect.com/posts/localhost_in_kestrel/><i class="fas fa-fw fa-pencil-alt"></i></a><article class="default article"><div class=featured-image><a href=https://azurecodingarchitect.com/posts/localhost_in_kestrel/><img src=/kestrel/kestrel-feature.png alt></a></div><div class=content><h1 class=article-title><a href=https://azurecodingarchitect.com/posts/localhost_in_kestrel/>Note to self: localhost in kestrel is localhost</a></h1><div class=meta><span class="date moment">2022-02-23</span>
<span class=readingTime>3 min read</span>
<span class=categories><a href=https://azurecodingarchitect.com/categories/technical/>Technical</a>
</span><span class=author><a href=https://azurecodingarchitect.com/author/bas-van-de-sande/>Bas Van De Sande</a></span></div><p>In one of the projects I&rsquo;m involved in, I ran into a problem. In this project we are building a solution that is running on a Linux based Edge Device connected to Azure. On the Edge device, a <a href=https://k3s.io/>k3s</a> cluster hosts a number of services required by the solution. In order to be able to develop and debug on a Linux environment, I equiped my system with Hyper-V, an internal NAT switch and a fresh copy of Ubuntu.</p><p>Before starting actual development I created an out-of-the-box ASP.NET Core Web app, and published it as a Linux-X64 package on my Ubuntu image and started the application on the linux machine.</p><pre tabindex=0><code>cd /home/bas/debugtest
dotnet ./linuxdebugtest.dll
</code></pre><p><img src=/kestrel/kestrel-localhost-5000.png alt=localhost></p><p>I opened Chrome on my Windows host and tried to navigate to the test application (bas-edge:5000). Unfortunately I received the not connected message (ERR_CONNECTION_REFUSED).</p><p><img src=/kestrel/kestrel-oops.png alt="not connected"></p><p>For some reason I was not able to connect to ASP.NET Core application. What really confused me that I was able to attach the Visual Studio debugger to the published webservice on the VM. Samba was working, FTP was working&mldr; I was baffled. <em>Could it be a port?</em></p><p>The first step was to ensure that the ufw (uncomplicated firewall) on ubuntu was disabled. Actually this can be dangerous, as there is no protection againt malicious traffic on the VM. In this case not a problem because the network is an internal network on my machine.</p><pre tabindex=0><code>sudo ufw disable
</code></pre><p>Then I opened the appsettings.json file, but nothing was to be seen there.</p><pre tabindex=0><code>{
  &#34;Logging&#34;: {
    &#34;LogLevel&#34;: {
      &#34;Default&#34;: &#34;Information&#34;,
      &#34;Microsoft.AspNetCore&#34;: &#34;Warning&#34;
    }
  },
  &#34;AllowedHosts&#34;: &#34;*&#34;
}
</code></pre><p>I did some googling and found an article that described that you can specify to what ports Kestrel (the embedded NET CORE webserver) should be listening. I extended the appsettings.json with the following lines to make kestrel listening to port 5400 (http) and 5401 (https) on Localhost.</p><pre tabindex=0><code>{
  &#34;Logging&#34;: {
    &#34;LogLevel&#34;: {
      &#34;Default&#34;: &#34;Information&#34;,
      &#34;Microsoft.AspNetCore&#34;: &#34;Warning&#34;
    }
  },
  &#34;AllowedHosts&#34;: &#34;*&#34;,
  &#34;Kestrel&#34;: {
    &#34;Endpoints&#34;: {
      &#34;Http&#34;: {
        &#34;Url&#34;: &#34;http://localhost:5400&#34;
      },
      &#34;Https&#34;: {
        &#34;Url&#34;: &#34;https://localhost:5401&#34;
      }
    }
  }
}
</code></pre><p>I restarted the webserver and saw that it was listening to port 5400/5401</p><p><img src=/kestrel/kestrel-localhost.png alt=localhost></p><p>And I tried again, without luck. It turned out that Kestrel is very picky about the urls you specify. When you specify localhost, Kestrel will only listen to the localhost IP Address (which is 127.0.0.1). In Kestrel you need to specify the IP address on which it should be listening. This is either the IP address of the machine of even better a wildcard (*).</p><p>Changing the url to http://<em>:5400 and https://</em>:5401 solved my issue&mldr;</p><pre tabindex=0><code>{
  &#34;Logging&#34;: {
    &#34;LogLevel&#34;: {
      &#34;Default&#34;: &#34;Information&#34;,
      &#34;Microsoft.AspNetCore&#34;: &#34;Warning&#34;
    }
  },
  &#34;AllowedHosts&#34;: &#34;*&#34;,
  &#34;Kestrel&#34;: {
    &#34;Endpoints&#34;: {
      &#34;Http&#34;: {
        &#34;Url&#34;: &#34;http://*:5400&#34;
      },
      &#34;Https&#34;: {
        &#34;Url&#34;: &#34;https://*:5401&#34;
      }
    }
  }
}
</code></pre><p><img src=/kestrel/kestrel-connected.png alt></p><p>A lesson to remember, time for serious development&mldr;</p></div><div class=footer><div class=tags><i class="fa fa-tags"></i><div class=links><a href=https://azurecodingarchitect.com/tags/csharp/>Csharp</a>
<a href=https://azurecodingarchitect.com/tags/debug/>Debug</a>
<a href=https://azurecodingarchitect.com/tags/troubleshooting/>Troubleshooting</a></div></div></div></article></div><div id=comments-container><script src=https://giscus.app/client.js data-repo=basvandesande/azurecodingarchitect data-repo-id=R_kgDOG3nWLg data-category=General data-category-id=DIC_kwDOG3nWLs4CBPIU data-mapping=pathname data-reactions-enabled=1 data-emit-metadata data-theme=light data-lang=en crossorigin=anonymous async></script><div id=giscus></div></div></div><footer><div class=container><div class=recent-posts><strong>Latest posts</strong><ul><li><a href=https://azurecodingarchitect.com/posts/github-context/>Quick tip: Get in control by using your GitHub context</a></li><li><a href=https://azurecodingarchitect.com/posts/find-rbac-permissions/>Quick tip: Find permissions in RBAC roles easily</a></li><li><a href=https://azurecodingarchitect.com/posts/diagnosticlogging/>Where is that documentation? A tale on setting up diagnostic settings...</a></li><li><a href=https://azurecodingarchitect.com/posts/frontdoor/>A nightmare on FrontDoor in Bicep...</a></li><li><a href=https://azurecodingarchitect.com/posts/gitcredentials/>Note to self: fix invalid GitHub credentials in VSCode</a></li><li><a href=https://azurecodingarchitect.com/posts/ghas-starting-with-codeql/>GHAS - How to use CodeQL custom queries?</a></li><li><a href=https://azurecodingarchitect.com/posts/sc100/>How to prepare for the Azure Cybersecurity Architect SC-100 exam</a></li></ul></div><div class=categories><a href=/categories/><strong>Categories</strong></a><ul><li><a href=/categories/development>Development
(8)</a></li><li><a href=/categories/general>General
(7)</a></li><li><a href=/categories/technical>Technical
(6)</a></li><li><a href=/categories/technology>Technology
(4)</a></li><li><a href=/categories/machine-learning>Machine learning
(1)</a></li><li><a href=/categories/tips-and-tricks>Tips and tricks
(1)</a></li><li><a href=/categories/troubleshooting>Troubleshooting
(1)</a></li></ul></div><div class=right><div class=external-profiles><strong>Social media</strong>
<a href=https://twitter.com/basvandesande target=_blank><i class="fab fa-twitter"></i></a>
<a href=https://linkd.in/basvandesande target=_blank><i class="fab fa-linkedin"></i></a>
<a href="mailto:bas@vd-sande.nl?subject=[AzureCodingArchitect]" target=_blank><i class="fa fa-envelope"></i></a>
<a href=/index.xml target=_blank><i class="fas fa-rss"></i></a></div><div class=external-profiles><strong>About me</strong>
<a href=https://xpirit.com/team/bas-van-de-sande/ target=_blank><i class="fas fa-robot" &nbsp;></i></a></div></div></div></footer><div class=credits><div class=container><div class=copyright><a href=https://azurecodingarchitect.com target=_blank>&copy;
2024
- Bas van de Sande - all rights reserved</div><div class=author><a href=https://github.com/Lednerb/bilberry-hugo-theme target=_blank>Bilberry Hugo theme</a></div></div></div><script type=text/javascript src=https://azurecodingarchitect.com/theme.js></script></body></html>