<!doctype html><html class=no-js lang=en><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=siteBaseUrl content="https://azurecodingarchitect.com/"><meta name=author content="Bas van de Sande"><meta name=description content="Tinkering with Azure and other technologies"><meta name=keywords content="blog,azure,cosmosdb,aks,kubernetes,k3s,docker,c#,visualstudio,architecture,technology,xpirit"><meta name=generator content="Hugo 0.111.3"><title>Minikube, a lightweight Kubernetes-to-go! | Azure Coding Architect</title><meta name=description content="Getting started with Minikube"><meta itemprop=name content="Minikube, a lightweight Kubernetes-to-go!"><meta itemprop=description content="Getting started with Minikube"><meta property="og:title" content="Minikube, a lightweight Kubernetes-to-go!"><meta property="og:description" content="Getting started with Minikube"><meta property="og:image" content="https://azurecodingarchitect.com/minikube/minikube-feature.png"><meta property="og:url" content="https://azurecodingarchitect.com/posts/minikube/"><meta property="og:site_name" content="Azure Coding Architect"><meta property="og:type" content="article"><script src=/modernizr-simple.js></script>
<link href=/posts/minikube/ rel=alternate type=application/rss+xml title="Azure Coding Architect"><link href=/posts/minikube/ rel=feed type=application/rss+xml title="Azure Coding Architect"><link rel=canonical href=https://azurecodingarchitect.com/posts/minikube/><link rel=stylesheet href=https://azurecodingarchitect.com/theme.css></head><body class=bilberry-hugo-theme><nav><div class=container><ul class=topnav><li><a href=https://xpirit.com/team/bas-van-de-sande/ target=_blank>About Me</a></li><li><a href=https://www.credly.com/users/bas-van-de-sande/badges target=_blank>Certifications</a></li></ul></div></nav><header><div class=container><div class=logo><a href=/ class=logo><img src=/bas.png alt>
<span class=overlay><i class="fa fa-home"></i></span></a></div><div class=titles><h3 class=title><a href=/>Azure Coding Architect</a></h3><span class=subtitle>Tinkering in the cloud...</span></div><div class=toggler><i class="fa fa-bars" aria-hidden=true></i></div></div></div></header><div class="main container"><div class="article-wrapper u-cf single"><a class=bubble href=https://azurecodingarchitect.com/posts/minikube/><i class="fas fa-fw fa-pencil-alt"></i></a><article class="default article"><div class=featured-image><a href=https://azurecodingarchitect.com/posts/minikube/><img src=/minikube/minikube-feature.png alt></a></div><div class=content><h1 class=article-title><a href=https://azurecodingarchitect.com/posts/minikube/>Minikube, a lightweight Kubernetes-to-go!</a></h1><div class=meta><span class="date moment">2022-12-02</span>
<span class=readingTime>4 min read</span>
<span class=categories><a href=https://azurecodingarchitect.com/categories/development/>development</a></span>
<span class=author><a href=https://azurecodingarchitect.com/author/bas-van-de-sande/>Bas van de Sande</a></span></div><p>From time-to-time I find myself tinkering with Kubernetes. I love the idea that I can create any type of workload (e.g. a simple webapp or a backend service), pick it up and put it somewhere else to run. Not having to care if it is in the cloud or on an on-premise cluster. However developing your application, testing its core in a local docker container and then deploying it to kubernetes can sometimes be cumberstone.</p><p>Having a full-blown kubernetes running on your development machine isn&rsquo;t something that I desire; personally I like to keep my machine as lean and mean as possible. I would love to develop and test my Kubernetes orchestrations locally, before I release them into the wild. A good solution: <strong>Minikube</strong>.</p><p>In this blog post I describe how you can start using it on Windows 11, without having to reinvent the wheel.</p><h2 id=prerequisites>Prerequisites</h2><p>In order to use Minikube, your windows 11 machine has to be equiped with:</p><h3 id=wsl2>WSL2</h3><p>WSL is the &ldquo;Windows Subsystem for Linux&rdquo;. MS-Learn has a <a href=https://learn.microsoft.com/en-us/windows/wsl/install>good article</a> on enabling WSL2 on Windows. Once WSL is enabled and the Linux distribution of choice is installed, perform the following check to see if the Linux distribution runs in WSL 2 mode. WSL can run distributions in both v1 or v2 mode.</p><p>To check the WSL mode, run:</p><pre tabindex=0><code>wsl.exe -l -v
</code></pre><p>To upgrade your existing Linux distro to v2, run:</p><pre tabindex=0><code>wsl.exe --set-version (distro name) 2
</code></pre><p>To set v2 as the default version for future installations, run:</p><pre tabindex=0><code>wsl.exe --set-default-version 2
</code></pre><h3 id=docker-desktop-v20x-and-up>Docker Desktop v20.x and up</h3><p>Download <a href=https://www.docker.com/>Docker Desktop for Windows</a> and start the installation once WSL2 installation finished. During installation specify that WSL2 has to be used.</p><p>The Windows Subsystem for Linux (WSL) 2 introduces a significant architectural change as it is a full Linux kernel built by Microsoft, allowing Linux distributions to run without having to manage Virtual Machines. Docker Desktop uses the dynamic memory allocation feature in WSL2 to improve on resource consumption. This means, Docker Desktop only uses the required amount of CPU and memory resources it needs, while enabling CPU and memory-intensive tasks such as building a container to run much faster.</p><p><img src=/minikube/minikube-docker.png alt="docker settings"></p><h2 id=installing-minikube>Installing Minikube</h2><p>Download Minikube by going to this <a href=https://minikube.sigs.k8s.io/docs/start/>Page</a>.</p><p><img src=/minikube/minikube-download.png alt=install></p><p>Choose the Binary for Windows and either click the &ldquo;latest release&rdquo; link or follow the Poweshell instructions in the blue pane. During the installation procedure specify that Docker has to be used for running the containers. The containers that are being used by Minikube itself to host its own processes, are ran on the local Docker Desktop Engine.</p><h2 id=running-minikube>Running Minikube</h2><p>Once everything is installed, it&rsquo;s time to get your hands dirty, time to fire up a Powershell terminal.</p><p>Minikube has to be started manually, so to start Minikube enter the following command</p><pre tabindex=0><code>minikube start
</code></pre><p><img src=/minikube/minikube-start.png alt=start></p><p>From this point on, a development Kubernetes cluster (with a single system node) is available. The command kubectl can be used to manage the various resources on the cluster, such as pod, ingress, service, secret etc.</p><h2 id=minikube-dashboard>Minikube dashboard</h2><p>Minikube comes with a management dashboard in which the cluster can be managed. To start the dashboard, enter the following command in a new terminal window.</p><pre tabindex=0><code>minikube dashboard
</code></pre><p><img src=/minikube/minikube-dashboard.png alt=dashboard></p><h2 id=running-the-first-orchestration>Running the first orchestration</h2><p>I created a small web application using dotNet 6.0 in a docker container. I tested the application on docker and it ran like a charm. The next step was to create a pod, a service and an ingress to host the web application on Minikube.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#f92672>apiVersion</span>: <span style=color:#ae81ff>v1</span>
</span></span><span style=display:flex><span><span style=color:#f92672>kind</span>: <span style=color:#ae81ff>Pod</span>
</span></span><span style=display:flex><span><span style=color:#f92672>metadata</span>:
</span></span><span style=display:flex><span>  <span style=color:#f92672>name</span>: <span style=color:#ae81ff>my-secret-pod</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>labels</span>:
</span></span><span style=display:flex><span>    <span style=color:#f92672>app</span>: <span style=color:#ae81ff>my-secret-app</span>
</span></span><span style=display:flex><span><span style=color:#f92672>spec</span>:
</span></span><span style=display:flex><span>  <span style=color:#f92672>containers</span>:
</span></span><span style=display:flex><span>    - <span style=color:#f92672>name</span>: <span style=color:#ae81ff>my-secret-container</span>
</span></span><span style=display:flex><span>      <span style=color:#f92672>image</span>: <span style=color:#ae81ff>basvandesande/mssecret</span>
</span></span><span style=display:flex><span>      <span style=color:#f92672>ports</span>:
</span></span><span style=display:flex><span>      - <span style=color:#f92672>containerPort</span>: <span style=color:#ae81ff>80</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>restartPolicy</span>: <span style=color:#ae81ff>Always</span>
</span></span><span style=display:flex><span>---
</span></span><span style=display:flex><span><span style=color:#f92672>apiVersion</span>: <span style=color:#ae81ff>v1</span>
</span></span><span style=display:flex><span><span style=color:#f92672>kind</span>: <span style=color:#ae81ff>Service</span>
</span></span><span style=display:flex><span><span style=color:#f92672>metadata</span>:
</span></span><span style=display:flex><span>  <span style=color:#f92672>name</span>: <span style=color:#ae81ff>my-secret-service</span>
</span></span><span style=display:flex><span><span style=color:#f92672>spec</span>:
</span></span><span style=display:flex><span>  <span style=color:#f92672>type</span>: <span style=color:#ae81ff>NodePort </span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>selector</span>:
</span></span><span style=display:flex><span>    <span style=color:#f92672>app</span>: <span style=color:#ae81ff>my-secret-app</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>ports</span>:
</span></span><span style=display:flex><span>  - <span style=color:#f92672>name</span>: <span style=color:#ae81ff>my-secret-service-port</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>protocol</span>: <span style=color:#ae81ff>TCP</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>port</span>: <span style=color:#ae81ff>30080</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>targetPort</span>: <span style=color:#ae81ff>80</span>
</span></span><span style=display:flex><span>---
</span></span><span style=display:flex><span><span style=color:#f92672>apiVersion</span>: <span style=color:#ae81ff>networking.k8s.io/v1</span>
</span></span><span style=display:flex><span><span style=color:#f92672>kind</span>: <span style=color:#ae81ff>Ingress</span>
</span></span><span style=display:flex><span><span style=color:#f92672>metadata</span>:
</span></span><span style=display:flex><span>  <span style=color:#f92672>name</span>: <span style=color:#ae81ff>my-secret-ingress</span>
</span></span><span style=display:flex><span><span style=color:#f92672>spec</span>:
</span></span><span style=display:flex><span>  <span style=color:#f92672>rules</span>:
</span></span><span style=display:flex><span>    - <span style=color:#f92672>http</span>:
</span></span><span style=display:flex><span>        <span style=color:#f92672>paths</span>:
</span></span><span style=display:flex><span>          - <span style=color:#f92672>path</span>: <span style=color:#ae81ff>/</span>
</span></span><span style=display:flex><span>            <span style=color:#f92672>pathType</span>: <span style=color:#ae81ff>Prefix</span>
</span></span><span style=display:flex><span>            <span style=color:#f92672>backend</span>:
</span></span><span style=display:flex><span>              <span style=color:#f92672>service</span>:
</span></span><span style=display:flex><span>                <span style=color:#f92672>name</span>: <span style=color:#ae81ff>my-secret-service</span>
</span></span><span style=display:flex><span>                <span style=color:#f92672>port</span>:
</span></span><span style=display:flex><span>                  <span style=color:#f92672>number</span>: <span style=color:#ae81ff>30080</span>
</span></span></code></pre></div><p>The logic in the yaml is straight forward.</p><ul><li>The ingress is configured to forward all incoming http traffic to the service (incoming port: 30080).</li><li>The service forwards the incoming traffic on port 30080 to port 80.</li><li>The web application in the pod listens to port 80.</li></ul><p>The resources were created on the Minikube cluster using the following command</p><pre tabindex=0><code>kubectl create -f mssecretstuff.yml
</code></pre><p>I opened browser and navigated to localhost (127.0.0.1) to view the page, and it failed&mldr;.</p><p><img src=/minikube/minikube-fail.png alt=fail></p><h2 id=use-the-tunnel-luke>Use the Tunnel, Luke!</h2><p>This costed me a while to figure out (just because I didn&rsquo;t read the documentation). In order to work with Ingress on Minikube, you need to set up a tunnel. The tunnel captures all traffic sent to localhost and forwards it to the running Minikube instance. To activate the tunnel, open a new terminal window and enter the following command</p><pre tabindex=0><code>minikube tunnel
</code></pre><p><img src=/minikube/minikube-tunnel.png alt=tunnel></p><p>After refreshing the web page, the Website appeared. <strong>Result!</strong></p><p><img src=/minikube/minikube-result.png alt=tunnel></p><p>When done developing or tinkering, just stop Minikube by entering the following command.</p><pre tabindex=0><code>minikube stop
</code></pre></div><div class=footer><div class=tags><i class="fa fa-tags"></i><div class=links><a href=https://azurecodingarchitect.com/tags/kubernetes/>kubernetes</a>
<a href=https://azurecodingarchitect.com/tags/getting-started/>getting started</a>
<a href=https://azurecodingarchitect.com/tags/installation/>installation</a>
<a href=https://azurecodingarchitect.com/tags/usage/>usage</a></div></div></div></article></div><div id=comments-container><script src=https://giscus.app/client.js data-repo=basvandesande/azurecodingarchitect data-repo-id=R_kgDOG3nWLg data-category=General data-category-id=DIC_kwDOG3nWLs4CBPIU data-mapping=pathname data-reactions-enabled=1 data-emit-metadata data-theme=light data-lang=en crossorigin=anonymous async></script><div id=giscus></div></div></div><footer><div class=container><div class=recent-posts><strong>Latest posts</strong><ul><li><a href=https://azurecodingarchitect.com/posts/ghas-starting-with-codeql/>GHAS - How to use CodeQL custom queries?</a></li><li><a href=https://azurecodingarchitect.com/posts/sc100/>How to prepare for the Azure Cybersecurity Architect SC-100 exam</a></li><li><a href=https://azurecodingarchitect.com/posts/volterra-take1/>Project Volterra - Windows Dev Kit 2023 - take 1</a></li><li><a href=https://azurecodingarchitect.com/posts/minikube/>Minikube, a lightweight Kubernetes-to-go!</a></li><li><a href=https://azurecodingarchitect.com/posts/wiremock_net/>Real world mocking! Http Service testing in C# using Wiremock.Net</a></li><li><a href=https://azurecodingarchitect.com/posts/certification/>Just do it! Work on your certifications.</a></li><li><a href=https://azurecodingarchitect.com/posts/ota-update/>Over-The-Air device update - IoT with C#</a></li></ul></div><div class=categories><a href=/categories/><strong>Categories</strong></a><ul><li><a href=/categories/general>General
(7)</a></li><li><a href=/categories/development>Development
(6)</a></li><li><a href=/categories/technology>Technology
(4)</a></li><li><a href=/categories/machine-learning>Machine learning
(1)</a></li><li><a href=/categories/technical>Technical
(1)</a></li></ul></div><div class=right><div class=external-profiles><strong>Social media</strong>
<a href=https://twitter.com/basvandesande target=_blank><i class="fab fa-twitter"></i></a>
<a href=https://linkd.in/basvandesande target=_blank><i class="fab fa-linkedin"></i></a>
<a href="mailto:bas@vd-sande.nl?subject=[AzureCodingArchitect]" target=_blank><i class="fa fa-envelope"></i></a>
<a href=/index.xml target=_blank><i class="fas fa-rss"></i></a></div><div class=external-profiles><strong>About me</strong>
<a href=https://xpirit.com/team/bas-van-de-sande/ target=_blank><i class="fas fa-robot" &nbsp;></i></a></div></div></div></footer><div class=credits><div class=container><div class=copyright><a href=https://azurecodingarchitect.com target=_blank>&copy;
2023
- Bas van de Sande - all rights reserved</div><div class=author><a href=https://github.com/Lednerb/bilberry-hugo-theme target=_blank>Bilberry Hugo theme</a></div></div></div><script type=text/javascript src=https://azurecodingarchitect.com/theme.js></script></body></html>