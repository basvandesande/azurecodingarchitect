<!doctype html><html class=no-js lang=en><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=siteBaseUrl content="https://azurecodingarchitect.com/"><meta name=author content="Bas van de Sande"><meta name=description content="Tinkering with Azure and other technologies"><meta name=keywords content="blog,azure,cosmosdb,aks,kubernetes,k3s,docker,c#,visualstudio,architecture,technology,xpirit"><meta name=generator content="Hugo 0.122.0"><title>From 0 to 100 in 30 minutes - IoT with C# | Azure Coding Architect
</title><meta name=description content="Dive into the world of IoT using the Nano .Net framrwork"><meta itemprop=name content="From 0 to 100 in 30 minutes - IoT with C#"><meta itemprop=description content="Dive into the world of IoT using the Nano .Net framrwork"><meta property="og:title" content="From 0 to 100 in 30 minutes - IoT with C#"><meta property="og:description" content="Dive into the world of IoT using the Nano .Net framrwork"><meta property="og:image" content="https://azurecodingarchitect.com/prepareiot/iot-feature.png"><meta property="og:url" content="https://azurecodingarchitect.com/posts/prepare-for-iot/"><meta property="og:site_name" content="Azure Coding Architect"><meta property="og:type" content="article"><script src=/modernizr-simple.js></script><link href=/posts/prepare-for-iot/ rel=alternate type=application/rss+xml title="Azure Coding Architect"><link href=/posts/prepare-for-iot/ rel=feed type=application/rss+xml title="Azure Coding Architect"><link rel=canonical href=https://azurecodingarchitect.com/posts/prepare-for-iot/><link rel=stylesheet href=https://azurecodingarchitect.com/theme.css></head><body class=bilberry-hugo-theme><nav><div class=container><ul class=topnav><li><a href=https://azurecodingarchitect.com/page/erd-creator/>Entity Relationship Diagram Creator</a></li><li><a href=https://xpirit.com/team/bas-van-de-sande/ target=_blank>About Me</a></li><li><a href=https://learn.microsoft.com/en-us/users/basvandesande-8898/transcript/vmzk8agyxgwpjkn target=_blank>Certifications</a></li></ul></div></nav><header><div class=container><div class=logo><a href=/ class=logo><img src=/bas.png alt>
<span class=overlay><i class="fa fa-home"></i></span></a></div><div class=titles><h3 class=title><a href=/>Azure Coding Architect</a></h3><span class=subtitle>Tinkering in the cloud...</span></div><div class=toggler><i class="fa fa-bars" aria-hidden=true></i></div></div></div></header><div class="main container"><div class="article-wrapper u-cf single"><a class=bubble href=https://azurecodingarchitect.com/posts/prepare-for-iot/><i class="fas fa-fw fa-pencil-alt"></i></a><article class="default article"><div class=featured-image><a href=https://azurecodingarchitect.com/posts/prepare-for-iot/><img src=/prepareiot/iot-feature.png alt></a></div><div class=content><h1 class=article-title><a href=https://azurecodingarchitect.com/posts/prepare-for-iot/>From 0 to 100 in 30 minutes - IoT with C#</a></h1><div class=meta><span class="date moment">2022-03-15</span>
<span class=readingTime>4 min read</span>
<span class=categories><a href=https://azurecodingarchitect.com/categories/development/>development</a>
</span><span class=author><a href=https://azurecodingarchitect.com/author/bas-van-de-sande/>Bas van de Sande</a></span></div><p>My interest for the Internet of Things (IoT) was sparked many moons ago, way before the name was born. Back in the days I wrote software for PalmOS devices, and I was intrigued by having raw processor power in my Pocket. Don&rsquo;t get me wrong, back then we where talking Megahertz instead of Gigahertz and Kilobyte instead of Gigabyte. Having such limitations in processing power and memory tickled my creativity.
When I had the opportunity to control hardware (gps, electronic locks etc) using the little devices I was sold. Fastforward to a couple of years ago when the market was flooded with Arduinos and Raspberry Pis, I picked up an old hobby and started developing again, this time playing around with sensors. The big disadvantage was that you had to resort to plain old C and a crippled development environment, until now&mldr;</p><p>At the last innovation day at <a href=https://xpirit.com>Xpirit</a>, I teamed with a group of like-minded collegues and tinkered a day with a solution around Azure IoT. A collegue and I tried to flash an ESP8266 board to run the <a href=https://nanoframework.net/>.Net NanoFramework</a>: The NanoFramework is a slimmed down version of the .Net Framework, targeted to run on an ESP32 device.</p><p>It turned out that the board we had was not suitable to run the NanoFramework. I decided to order a new ESP32 board and started tinkering with it. In this blog post I&rsquo;ll give you a jump start to get you and your Windows development machine up-to-speed under 30 minutes.</p><h2 id=prerequisites>Prerequisites</h2><p>An compatible ESP32 board
I used an ESP-WROOM-32 board (<a href="https://www.amazon.com/Teyleten-Robot-ESP-WROOM-32-Development-Microcontroller/dp/B08246MCL5/ref=sr_1_3?keywords=ESP32&amp;qid=1647460094&amp;sr=8-3">amazon.com</a>).</p><p>Micro USB cable</p><p>Your Windows 10/11 environment should be equiped with:</p><ul><li><p>Microsoft .Net 6 SDK</p></li><li><p>Visual Studio 2022 - version 17.1.1 and up</p></li><li><p>Nano Firmware Flasher (nanoff)</p><p>This software can be downloaded from <a href=https://github.com/nanoframework/nanoFirmwareFlasher>https://github.com/nanoframework/nanoFirmwareFlasher</a></p></li></ul><h2 id=preparations>Preparations</h2><p>First I do the preparations for the device, then the preparation for Visual Studio.</p><h3 id=install-nanoff>Install nanoff</h3><p>Nanoff is the tool that is used to flash the NanoFramework firmware to the ESP32, this can be installed by entering the following command:</p><pre tabindex=0><code>dotnet tool install -g nanoff
</code></pre><p><img src=/prepareiot/iot-nanoff.png alt="Install nanoff"></p><h3 id=find-available-com-ports>Find available com ports</h3><p>Now it is time to hook up the ESP32 board to your computer over USB. Once done, enter the following command to get the available COM ports on your machine:</p><pre tabindex=0><code>nanoff --listports
</code></pre><p><img src=/prepareiot/iot-listports.png alt="Show available COM ports"></p><h3 id=test-device-communication-over-nanoff>Test device communication over nanoff</h3><p>Make sure that the board can be read from nanoff. This can be done by entering the following command:</p><pre tabindex=0><code>nanoff --serialport com5
</code></pre><p><img src=/prepareiot/iot-boardinfo.png alt="Get the board info"></p><h3 id=flash-the-device>Flash the device</h3><p>After communications have been tested, the time has come to flash the device with the nanoframework. In nanoff you can either choose to specify a specific image (&ndash;target MY_TARGET_NAME_HERE) that needs to be flashed or you can let nanoff choose an image for you (&ndash;platform esp32 &ndash;preview). I choose the latter option.</p><pre tabindex=0><code>nanoff --serialport com5 --platform esp32 --preview
</code></pre><p><img src=/prepareiot/iot-flashed-platform.png alt="Flashed Device"></p><h3 id=prepare-visual-studio-2022>Prepare Visual Studio 2022</h3><p>Before Visual Studio 2022 can be used the NanoFramework extension needs to be added.</p><ul><li>Open Visual Studio</li><li>Go to Extensions &ndash;> Manage Extensions</li><li>In the search box enter &ldquo;nanoframework&rdquo;</li><li>Download and install the .Net nanoframework Extension</li></ul><p><img src=/prepareiot/iot-vs2022.png alt="VS2022 extension"></p><h2 id=development-time>Development time</h2><p>When Visual Studio is restarted, you have 3 new project types which are targetting the NanoFramework. In here I choose for &ldquo;Blank Application (nanoFramework)&rdquo; and create a new solution.</p><p><img src=/prepareiot/iot-newprojecttypes.png alt="NanoFramework project types"></p><p>Before I can deploy the application to the ESP32 device, I need to add the Device Explorer.</p><ul><li>Go to View &ndash;> Other Windows &ndash;> Device Explorer</li></ul><p><img src=/prepareiot/iot-setdevice1.png alt="Add Device Explorer"></p><p>In the Device Explorer I select my device that appears and press the &ldquo;Ping&rdquo; button to test the communication. A confirmation is printed in the Output pane.</p><p><img src=/prepareiot/iot-setdevice2.png alt="Ping success"></p><h2 id=ensure-correct-version-of-mscorlib>Ensure correct version of mscorlib</h2><p>Before deploying the software to the device, it is important that the mscorlib is compatible with the firmware on the ESP32 device. Go to the NuGet package manager and update it to a matching version. In my was was this the latest preview version (as I specified the &ndash;preview for the flash operation in nanoff). If the versions are not compatible an error message will appear in the output pane indicating that the versions have to match (<a href=https://docs.nanoframework.net/content/getting-started-guides/trouble-shooting-guide.html#when-you-attempt-to-debug-you-get-a-deployment-error-and-you-see-a-message-couldnt-find-a-valid-assembly-required-by-mscorlib-in-the-output-windownet-nanoframework-extension>troubleshooting</a>)</p><p><img src=/prepareiot/iot-mscorlib.png alt=mscorlib></p><h2 id=time-to-debug>Time to debug&mldr;.</h2><p>When you right click the project, you can choose &ldquo;Deploy&rdquo;. With this option the software will be uploaded to the device. Pressing F5 starts a debug session on the device.</p><p><img src=/prepareiot/iot-debug.png alt="Debug breakpoint"></p><p>This provides me with a good starting point to hook up the device to the Azure IoT hub and start experimenting with the Device Provisioning Service&mldr;</p></div><div class=footer><div class=tags><i class="fa fa-tags"></i><div class=links><a href=https://azurecodingarchitect.com/tags/csharp/>Csharp</a>
<a href=https://azurecodingarchitect.com/tags/nanoframework/>nanoframework</a>
<a href=https://azurecodingarchitect.com/tags/iot/>IoT</a></div></div></div></article></div><div id=comments-container><script src=https://giscus.app/client.js data-repo=basvandesande/azurecodingarchitect data-repo-id=R_kgDOG3nWLg data-category=General data-category-id=DIC_kwDOG3nWLs4CBPIU data-mapping=pathname data-reactions-enabled=1 data-emit-metadata data-theme=light data-lang=en crossorigin=anonymous async></script><div id=giscus></div></div></div><footer><div class=container><div class=recent-posts><strong>Latest posts</strong><ul><li><a href=https://azurecodingarchitect.com/posts/find-rbac-permissions/>Quick tip: Find permissions in RBAC roles easily</a></li><li><a href=https://azurecodingarchitect.com/posts/diagnosticlogging/>Where is that documentation? A tale on setting up diagnostic settings...</a></li><li><a href=https://azurecodingarchitect.com/posts/frontdoor/>A nightmare on FrontDoor in Bicep...</a></li><li><a href=https://azurecodingarchitect.com/posts/gitcredentials/>Note to self: fix invalid GitHub credentials in VSCode</a></li><li><a href=https://azurecodingarchitect.com/posts/ghas-starting-with-codeql/>GHAS - How to use CodeQL custom queries?</a></li><li><a href=https://azurecodingarchitect.com/posts/sc100/>How to prepare for the Azure Cybersecurity Architect SC-100 exam</a></li><li><a href=https://azurecodingarchitect.com/posts/volterra-take1/>Project Volterra - Windows Dev Kit 2023 - take 1</a></li></ul></div><div class=categories><a href=/categories/><strong>Categories</strong></a><ul><li><a href=/categories/development>Development
(8)</a></li><li><a href=/categories/general>General
(7)</a></li><li><a href=/categories/technical>Technical
(5)</a></li><li><a href=/categories/technology>Technology
(4)</a></li><li><a href=/categories/machine-learning>Machine learning
(1)</a></li><li><a href=/categories/tips-and-tricks>Tips and tricks
(1)</a></li><li><a href=/categories/troubleshooting>Troubleshooting
(1)</a></li></ul></div><div class=right><div class=external-profiles><strong>Social media</strong>
<a href=https://twitter.com/basvandesande target=_blank><i class="fab fa-twitter"></i></a>
<a href=https://linkd.in/basvandesande target=_blank><i class="fab fa-linkedin"></i></a>
<a href="mailto:bas@vd-sande.nl?subject=[AzureCodingArchitect]" target=_blank><i class="fa fa-envelope"></i></a>
<a href=/index.xml target=_blank><i class="fas fa-rss"></i></a></div><div class=external-profiles><strong>About me</strong>
<a href=https://xpirit.com/team/bas-van-de-sande/ target=_blank><i class="fas fa-robot" &nbsp;></i></a></div></div></div></footer><div class=credits><div class=container><div class=copyright><a href=https://azurecodingarchitect.com target=_blank>&copy;
2024
- Bas van de Sande - all rights reserved</div><div class=author><a href=https://github.com/Lednerb/bilberry-hugo-theme target=_blank>Bilberry Hugo theme</a></div></div></div><script type=text/javascript src=https://azurecodingarchitect.com/theme.js></script></body></html>