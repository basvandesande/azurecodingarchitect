<!doctype html><html class=no-js lang=en><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=siteBaseUrl content="https://azurecodingarchitect.com/"><meta name=author content="Bas van de Sande"><meta name=description content="Tinkering with Azure and other technologies"><meta name=keywords content="blog,azure,cosmosdb,aks,kubernetes,k3s,docker,c#,visualstudio,architecture,technology,xpirit"><meta name=generator content="Hugo 0.99.1"><title>Running a persistent SQL Server in Docker | Azure Coding Architect</title><meta name=description content="SQL Server running in Docker with persistent storage and automatic rebinding after startup."><meta itemprop=name content="Running a persistent SQL Server in Docker"><meta itemprop=description content="SQL Server running in Docker with persistent storage and automatic rebinding after startup."><meta property="og:title" content="Running a persistent SQL Server in Docker"><meta property="og:description" content="SQL Server running in Docker with persistent storage and automatic rebinding after startup."><meta property="og:image" content="https://azurecodingarchitect.com/sqldocker/sqldocker-feature.png"><meta property="og:url" content="https://azurecodingarchitect.com/posts/persistent-sql-docker/"><meta property="og:site_name" content="Azure Coding Architect"><meta property="og:type" content="article"><script src=/modernizr-simple.js></script>
<link href=/posts/persistent-sql-docker/ rel=alternate type=application/rss+xml title="Azure Coding Architect"><link href=/posts/persistent-sql-docker/ rel=feed type=application/rss+xml title="Azure Coding Architect"><link rel=canonical href=https://azurecodingarchitect.com/posts/persistent-sql-docker/><link rel=stylesheet href=https://azurecodingarchitect.com/theme.css></head><body class=bilberry-hugo-theme><nav><div class=container><ul class=topnav><li><a href=https://xpirit.com/team/bas-van-de-sande/ target=_blank>About Me</a></li><li><a href=https://www.credly.com/users/bas-van-de-sande/badges target=_blank>Certifications</a></li></ul></div></nav><header><div class=container><div class=logo><a href=/ class=logo><img src=/bas.png alt>
<span class=overlay><i class="fa fa-home"></i></span></a></div><div class=titles><h3 class=title><a href=/>Azure Coding Architect</a></h3><span class=subtitle>Tinkering in the cloud...</span></div><div class=toggler><i class="fa fa-bars" aria-hidden=true></i></div></div></div></header><div class="main container"><div class="article-wrapper u-cf single"><a class=bubble href=https://azurecodingarchitect.com/posts/persistent-sql-docker/><i class="fas fa-fw fa-pencil-alt"></i></a><article class="default article"><div class=featured-image><a href=https://azurecodingarchitect.com/posts/persistent-sql-docker/><img src=/sqldocker/sqldocker-feature.png alt></a></div><div class=content><h1 class=article-title><a href=https://azurecodingarchitect.com/posts/persistent-sql-docker/>Running a persistent SQL Server in Docker</a></h1><div class=meta><span class="date moment">2022-03-05</span>
<span class=readingTime>3 min read</span>
<span class=categories><a href=https://azurecodingarchitect.com/categories/development/>development</a></span>
<span class=author><a href=https://azurecodingarchitect.com/author/bas-van-de-sande/>Bas van de Sande</a></span></div><p>In IT we always want to work with the latest and greatest, it&rsquo;s in our DNA to explore new technologies. From time-to-time you get confronted with legacy technologies, robust but boring. One of such things is a piece of software I wrote more than 15 years ago for a friend. It was an application using a SQL Server database that controlled a couple of weighing terminals connected over RS232. Controlling machines is every geek&rsquo;s dream.
Every couple of years my friend asks me if I can help him to improve the software I wrote for him, this time it was no different.</p><p>The tedious part of doing extensions to old software is that you have to set up an environment to do so. Visual Studio is always present on my System. Source Code can be easily retrieved from the repository. Databases can be reattached to the database server. Well wait&mldr; what database server? My system has no database server installed and frankly I&rsquo;m not very willing to install a database server on my Windows system. Database Servers - such as SQL Server - are known memory and resource hogs.</p><p>This time I wanted to do it a bit different. I remembered that at Ignite 2019, Microsoft publically introduced SQL Server for Linux. Since I have WSL2 and Docker Desktop running on my system, why not run SQL Server from within a Docker Container? That way I only have to mount my database and ensure that the data modifications are persisted. Not rocket science, but a fun and convenient twist to this legacy project.</p><h4 id=my-wishes>My wishes</h4><p>Using Docker I wanted to achieve the following:</p><ol><li>SQL Server has to be available on demand. When I don&rsquo;t need it, it shouldn&rsquo;t be consuming resources (besides storage).</li><li>All actions in the databases should be persisted, which means that data or scheme modifications should be available next time I start the SQL Server docker container</li><li>It should be extendable without much effort. With extendable I mean that I easily can add or remove databases if needed.</li></ol><h4 id=docker-compose>Docker Compose</h4><p>In the root of my project I added the following docker-compose.yaml file.</p><pre tabindex=0><code>version: &#39;3.7&#39;
services:
  SQLServer:
   image: mcr.microsoft.com/mssql/server:2019-latest
   container_name: SQLServer2019
   environment:
     - ACCEPT_EULA=Y
     - SA_PASSWORD=MyVeryVerySecretPassword   
     - attach_dbs=[
          {
            &#39;dbName&#39;:&#39;WeegApplicatie&#39;,
            &#39;dbFiles&#39;: [ &#39;/var/opt/mssql/data/weegapplicatie.mdf&#39; , &#39;/var/opt/mssql/data/weegapplicatie_log.ldf&#39;]
          }
       ]
   ports:
     - &#39;1433:1433&#39;
   volumes:
     - C:\Data/SQLServerData:/var/opt/mssql/data
</code></pre><p>In the Docker Compose I do the following:</p><ol><li>Take the SQL Server 2019 image from the container registry.</li><li>Set the environment variables needed for the initialization of SQL Sever (acceptance of the EULA and the SA password)</li><li>Attach the database files that I need. Therefor specify a Database name that will be shown in SQL Server Management Studio and the name of the SQL data file and SQL transaction log file.
In the attach_db section, as many databases can be attached as needed.</li><li>Specify the port number for the container. In this case I map the well known port 1433 from the host to the image.</li><li>Finally specify the folder location on the host system (c:\Data/SQLServerData) and the path that is used inside the docker image (/var/opt/mssql/data).</li></ol><h4 id=lets-use-it>Let&rsquo;s use it</h4><p>The docker-compose is added to Docker by entering the following command on the command prompt from within the folder where the docker-compose.yaml is located:</p><pre tabindex=0><code>docker-compose up
</code></pre><p>When opening Docker Desktop, the SQL Server docker is already started.</p><p><img src=/sqldocker/sqldocker-docker.png alt="Docker Desktop"></p><p>When opening SQL Server Management Studio for the first time, the database needs to be attached. This is a one time action. The next time SQL Server is started the database will be attached manually; amd can be accessed directly.</p><p><img src=/sqldocker/sqldocker-ssms.png alt="SQL Server Management Studio"></p><p><strong>Sweet!</strong></p><p>Just open Docker Desktop and start the SQL Server image when you need it. When you don&rsquo;t need your database server anymore, all you have to do is to stop the image. SQL Server doesn&rsquo;t get much easier and more convenient than this.</p></div><div class=footer><div class=tags><i class="fa fa-tags"></i><div class=links><a href=https://azurecodingarchitect.com/tags/docker/>Docker</a>
<a href=https://azurecodingarchitect.com/tags/sql-server/>SQL Server</a>
<a href=https://azurecodingarchitect.com/tags/c#/>C#</a></div></div></div></article></div><div id=comments-container><script src=https://giscus.app/client.js data-repo=basvandesande/azurecodingarchitect data-repo-id=R_kgDOG3nWLg data-category=General data-category-id=DIC_kwDOG3nWLs4CBPIU data-mapping=pathname data-reactions-enabled=1 data-emit-metadata data-theme=light data-lang=en crossorigin=anonymous async></script><div id=giscus></div></div></div><footer><div class=container><div class=recent-posts><strong>Latest posts</strong><ul><li><a href=https://azurecodingarchitect.com/posts/iot-nanoframework-dps/>Register ESP32 to DPS & IoT hub - IoT with C#</a></li><li><a href=https://azurecodingarchitect.com/posts/prepare-for-iot/>From 0 to 100 in 30 minutes - IoT with C#</a></li><li><a href=https://azurecodingarchitect.com/posts/persistent-sql-docker/>Running a persistent SQL Server in Docker</a></li><li><a href=https://azurecodingarchitect.com/posts/localhost_in_kestrel/>Note to self: localhost in kestrel is localhost</a></li><li><a href=https://azurecodingarchitect.com/posts/reboot/>Sometimes you need to reboot...</a></li><li><a href=https://azurecodingarchitect.com/posts/mutistage-gh-pipeline/>Multi-staged GitHub Pipeline</a></li><li><a href=https://azurecodingarchitect.com/posts/certification-renewal/>Certification Renewal</a></li></ul></div><div class=categories><a href=/categories/><strong>Categories</strong></a><ul><li><a href=/categories/development>Development
(3)</a></li><li><a href=/categories/general>General
(3)</a></li><li><a href=/categories/technical>Technical
(2)</a></li><li><a href=/categories/technology>Technology
(2)</a></li></ul></div><div class=right><div class=external-profiles><strong>Social media</strong>
<a href=https://twitter.com/basvandesande target=_blank><i class="fab fa-twitter"></i></a>
<a href=https://linkdin/basvandesande target=_blank><i class="fab fa-linkedin"></i></a>
<a href="mailto:bas@vd-sande.nl?subject=[AzureCodingArchitect]" target=_blank><i class="fa fa-envelope"></i></a>
<a href=/index.xml target=_blank><i class="fas fa-rss"></i></a></div><div class=external-profiles><strong>About me</strong>
<a href=https://xpirit.com/team/bas-van-de-sande/ target=_blank><i class="fas fa-robot" &nbsp;></i></a></div></div></div></footer><div class=credits><div class=container><div class=copyright><a href=https://azurecodingarchitect.com target=_blank>&copy;
2022
- Bas van de Sande - all rights reserved</div><div class=author><a href=https://github.com/Lednerb/bilberry-hugo-theme target=_blank>Bilberry Hugo theme</a></div></div></div><script type=text/javascript src=https://azurecodingarchitect.com/theme.js></script></body></html>